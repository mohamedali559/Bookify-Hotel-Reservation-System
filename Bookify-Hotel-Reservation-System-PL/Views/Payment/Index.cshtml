@model Bookify_Hotel_Reservation_System_PL.Models.PaymentViewModel

@{
    ViewData["Title"] = "Secure Payment";
}

@section Styles {
    <link rel="stylesheet" href="~/css/payment.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
}

<script src="https://cdn.tailwindcss.com"></script>

<!-- Hidden data attributes for JavaScript -->
<div id="booking-data" 
     data-booking-id="@Model.BookingId"
     data-guest-name="@Model.GuestName"
     data-guest-email="@Model.GuestEmail"
     data-room-type="@Model.RoomTypeName"
     data-check-in="@Model.CheckInDate?.ToString("yyyy-MM-dd")"
     data-check-out="@Model.CheckOutDate?.ToString("yyyy-MM-dd")"
     data-nights="@Model.NumberOfNights"
     data-total-price="@Model.Amount"
     style="display: none;">
</div>

<div class="card-container">
    <div class="text-center mb-6">
        <i class="fas fa-credit-card text-4xl text-[#25408f] mb-2"></i>
        <h2 class="text-2xl font-bold text-[#25408f]">Payment Information</h2>
        <p class="text-gray-600 text-sm mt-1">Complete your booking payment securely</p>
    </div>
    
    <div class="space-y-5">
        <div>
            <label class="font-semibold text-gray-700 block mb-2">
                <i class="fas fa-user"></i> Full Name
            </label>
            <input id="name" type="text" class="w-full p-3 rounded-lg border border-gray-300 bg-gray-50" value="@Model.GuestName" readonly />
        </div>

        <div>
            <label class="font-semibold text-gray-700 block mb-2">
                <i class="fas fa-envelope"></i> Email
            </label>
            <input id="email" type="email" class="w-full p-3 rounded-lg border border-gray-300 bg-gray-50" value="@Model.GuestEmail" readonly />
        </div>

        <div>
            <label class="font-semibold text-gray-700 block mb-2">
                <i class="fas fa-credit-card"></i> Card Information
            </label>
            <div id="card-element" class="rounded-lg bg-white shadow-sm border border-gray-300"></div>
            <p class="text-xs text-gray-500 mt-2">
                <i class="fas fa-lock"></i> Your payment information is secure and encrypted
            </p>
        </div>

        <button id="pay-btn" class="w-full bg-[#25408f] text-white py-4 rounded-lg font-bold text-lg hover:bg-[#4169c7] transition-all shadow-md hover:shadow-lg">
            <i class="fas fa-lock"></i> Pay Securely Now
        </button>
    </div>
</div>

<!-- Invoice Section (Hidden initially) -->
<div class="invoice" id="invoice-box" style="display: none;">
    <div class="text-center mb-6">
        <div class="inline-block p-4 bg-green-100 rounded-full mb-4">
            <i class="fas fa-check-circle text-5xl text-green-600"></i>
        </div>
        <h2 class="text-3xl font-bold text-green-600">Payment Successful!</h2>
        <p class="text-lg text-gray-600 mt-2">Golden Horizon Hotel</p>
        <p class="text-sm text-gray-500 mt-1">Thank you for your booking. Your reservation is confirmed!</p>
    </div>

    <div class="border-2 border-green-200 rounded-xl p-6 bg-gradient-to-br from-white to-green-50 shadow-lg" id="invoice-content-wrapper">
        <div class="flex items-center justify-between mb-4 pb-4 border-b-2 border-green-200">
            <div>
                <h3 class="text-xl font-bold text-[#25408f]">Booking Invoice</h3>
                <p class="text-sm text-gray-500">Golden Horizon Hotel Reservation</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-600">Date</p>
                <p class="font-semibold" id="invoice-date"></p>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4 text-base" id="invoice-content"></div>

        <div class="mt-6 pt-4 border-t-2 border-gray-300">
            <div class="flex justify-between items-center mb-2">
                <p class="text-lg font-semibold text-gray-700">Subtotal:</p>
                <p class="text-lg font-semibold" id="subtotal-price"></p>
            </div>
            <div class="flex justify-between items-center mb-4">
                <p class="text-sm text-gray-600">Tax & Service (0%):</p>
                <p class="text-sm text-gray-600">$0.00</p>
            </div>
            <div class="flex justify-between items-center pt-4 border-t-2 border-green-300">
                <p class="text-2xl font-bold text-[#25408f]">Total Paid:</p>
                <p class="text-2xl font-bold text-green-600" id="total-price"></p>
            </div>
        </div>
    </div>

    <div class="mt-5 flex gap-3 flex-wrap">
        <button id="download-pdf" class="flex-1 min-w-[200px] bg-[#25408f] text-white py-3 rounded-lg font-bold text-base hover:bg-[#4169c7] transition-all shadow-md hover:shadow-lg">
            <i class="fas fa-download"></i> Download Invoice
        </button>
        <a href="/Book/MyBookings" class="flex-1 min-w-[200px] bg-green-600 text-white py-3 rounded-lg font-bold text-base hover:bg-green-700 transition-all text-center shadow-md hover:shadow-lg">
            <i class="fas fa-list"></i> View My Bookings
        </a>
        <a href="/Room" class="flex-1 min-w-[200px] bg-gray-600 text-white py-3 rounded-lg font-bold text-base hover:bg-gray-700 transition-all text-center shadow-md hover:shadow-lg">
            <i class="fas fa-home"></i> Back to Rooms
        </a>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="~/js/payment.js?v=@DateTime.Now.Ticks"></script>
    <script>
        // Set invoice date
        document.addEventListener('DOMContentLoaded', function() {
            const dateElement = document.getElementById('invoice-date');
            if (dateElement) {
                dateElement.textContent = new Date().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        });
    </script>
}
